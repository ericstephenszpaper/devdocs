<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_275) on Mon Feb 01 17:28:16 EST 2021 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>AllFiles (zPaper kb WebApp 3.32 API)</title>
<meta name="date" content="2021-02-01">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="AllFiles (zPaper kb WebApp 3.32 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/AllFiles.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../com/knowledgebin/kb/BarcodeEmitter.html" title="class in com.knowledgebin.kb"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/knowledgebin/kb/AllFiles.html" target="_top">Frames</a></li>
<li><a href="AllFiles.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.knowledgebin.kb</div>
<h2 title="Class AllFiles" class="title">Class AllFiles</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>com.knowledgebin.kb.AllFiles</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">AllFiles</span>
extends <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block">This class encapsulates all access to the KnowledgeBin 'allfiles' directory.
 <p>This class must be instantiated at startup and used for all access to files within the 'allfiles' hierarchy.</p>
 <p>The archaic point to the multiple sub-directory strategy is to limit the number of sub-directories to &lt; 31998 to
 exist within <code>ext3</code> constraints.</p>
 <p>A snippet.ID consists of base 16 encoded userID in the first 8 characters followed by a uniquer ('Z', 'Y',...)
 then base 32 encoded timestamp in the remaining 9 characters.
 32^3 is 32768, just over the 31998 limit imposed by ext3. This is not likely to occur,
 unless we generate one directory per millisecond. </p>
 <p>The new subdirectory format is &lt&;allfiles&gt;/&lt;UserID&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;subDir&gt;
 which is built with the following code:
 <br><code>
 return new StringBuilder(128).append(allfiles)
   .append("/").append(dbID.substring(0, 8))    //               new directory every 32^9 ms or 1115 years
   .append("/").append(dbID.substring(8, 12))   // (32T records) new sub-directory every 32^6 ms or 12.42 days
   .append("/").append(dbID.substring(12, 15))  // (1G records)  new sub-directory every 32^3 ms or 32.768 seconds
   .append("/").append(dbID.substring(15, 18)); // (32K records) new sub-directory every millisecond
 </code>
 </p>
     <h4>#47489 - Refactor AllFiles.java to fully incorporate salesforce.com as repository.</h4><br>
     AllFiles.java is a core component used to retrieve files from the repository.
     <br>
      This proposal is to refactor AllFiles to incorporate the S3 and salesforce.com persistence mechanisms homogeneously within AllFiles.java.
     <p>
      Originally the repository was just the .../allfiles/... directory.
      Then the .../allfiles/... directory was made sub-ordinate(just a cache) to the S3 repository and AllFiles.java
      was refactored to fetch from S3 when a file did not exist in the file system,
      and also provide a persist method to store the files in S3 repository.
     </p>
     <p>
       An additional repository has been defined as salesforce.com.
       The AllFiles.java had a new persistToSalesforce method defined,
       however the corresponding fetch from salesforce.com was not implemented in AllFiles.java.
       This prevents use in a load balanced environment, and prevents cache maintenance.
     </p>
     <h4>#53443 Refactor to validate input parameters</h4></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#basePath">basePath</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#AllFiles-java.lang.String-">AllFiles</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;basePath)</code>
<div class="block">Constructor</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#extractKeyPrefix-java.io.File-">extractKeyPrefix</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;srcAllFiles)</code>
<div class="block">Extracts the S3 18 character bucketKeyPrefix from the subdirectories of the AllFiles path.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#getAbsolutePath-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-">getAbsolutePath</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
               <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
               <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData)</code>
<div class="block">Returns an absolute file path String to a file in the .../allfiles/...</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#getCanonicalPath-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-">getCanonicalPath</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
                <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
                <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData)</code>
<div class="block">Returns a canonical file path String to an existing file.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#getDir-java.lang.String-">getDir</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;allfilesPathID)</code>
<div class="block">Returns a <code>File</code> object to a directory.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#getFile-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-">getFile</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
       <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
       <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData)</code>
<div class="block">Returns a <code>File</code> object to an existing file.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#getFile-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-java.util.Date-">getFile</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
       <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
       <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
       <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Date.html?is-external=true" title="class or interface in java.util">Date</a>&nbsp;lastModified)</code>
<div class="block">Returns a <code>File</code> object to an existing file.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#mkdir-java.lang.String-">mkdir</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;allfilesPathID)</code>
<div class="block">Creates a new directory if one does not already exist.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html?is-external=true" title="class or interface in java.lang">StringBuilder</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#newDirPath-java.lang.String-">newDirPath</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;allfilesPathID)</code>
<div class="block">Returns a <code>StringBuilder</code> representing a directory path in the new format of
 &lt&;allfiles&gt;/&lt;UserID&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;subDir&gt;.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#newFile-java.lang.String-java.lang.String-">newFile</a></span>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
       <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename)</code>
<div class="block">Returns a <code>File</code> representing a file path in the new format of
 &lt&;allfiles&gt;/&lt;UserID&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;filename&gt;.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#persist-com.knowledgebin.kb.KBData-java.io.File-int-org.apache.log4j.Logger-">persist</a></span>(<a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
       <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;srcFile,
       int&nbsp;retention,
       org.apache.log4j.Logger&nbsp;logger)</code>
<div class="block">Persist the .../allfiles/...</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#persist-com.knowledgebin.kb.KBData-java.io.File-org.apache.log4j.Logger-">persist</a></span>(<a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
       <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;srcFile,
       org.apache.log4j.Logger&nbsp;logger)</code>
<div class="block">Convenience function to persist the AllFiles type file to the most appropriate repository</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../com/knowledgebin/kb/AllFiles.html#persistToSalesforce-com.knowledgebin.kb.KBData-javax.servlet.http.HttpServletRequest-java.lang.String-java.io.File-org.apache.log4j.Logger-">persistToSalesforce</a></span>(<a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
                   javax.servlet.http.HttpServletRequest&nbsp;request,
                   <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;destAllfilesPathID,
                   <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;destFile,
                   org.apache.log4j.Logger&nbsp;logger)</code>
<div class="block">NOTE: CRN170418 I CAN'T STRESS THIS ENOUGH: This method should be called by default by the persist() method.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="basePath">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>basePath</h4>
<pre>public final&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a> basePath</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="AllFiles-java.lang.String-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>AllFiles</h4>
<pre>public&nbsp;AllFiles(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;basePath)</pre>
<div class="block">Constructor</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>basePath</code> - the full path to the root allfiles directory (e.g. /zpallfiles or the deprecated /home/kbin/allfiles)</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="extractKeyPrefix-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>extractKeyPrefix</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;extractKeyPrefix(<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;srcAllFiles)</pre>
<div class="block">Extracts the S3 18 character bucketKeyPrefix from the subdirectories of the AllFiles path.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>srcAllFiles</code> - the file in allfiles subdirectory</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the clean allfilesPathID</dd>
</dl>
</li>
</ul>
<a name="newDirPath-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newDirPath</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/StringBuilder.html?is-external=true" title="class or interface in java.lang">StringBuilder</a>&nbsp;newDirPath(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;allfilesPathID)</pre>
<div class="block">Returns a <code>StringBuilder</code> representing a directory path in the new format of
 &lt&;allfiles&gt;/&lt;UserID&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;subDir&gt;.
 <code>
 new directory every (32^9 ms or 1115) years
 (32T records) new sub-directory every (32^6 ms or 12.42) days
 (1G records)  new sub-directory every (32^3 ms or 32.768) seconds
 (32K records) new sub-directory every millisecond
 </code></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>allfilesPathID</code> - the 18 character .../allfiles/... ID</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a <code>StringBuilder</code> representing a directory path in the new format of &lt;UserID&gt;/&lt;subDir&gt;//&lt;subDir&gt;/&lt;subDir&gt;.</dd>
</dl>
</li>
</ul>
<a name="newFile-java.lang.String-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newFile</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;newFile(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
                    <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename)</pre>
<div class="block">Returns a <code>File</code> representing a file path in the new format of
 &lt&;allfiles&gt;/&lt;UserID&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;filename&gt;.

 No operations for existence or creation is performed.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>requestedID</code> - the 18 or 37 character .../allfiles/... ID, the SF prefix is ignored</dd>
<dd><code>filename</code> - the base file name</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a <code>String</code> representing a directory path in the new format of &lt;UserID&gt;/&lt;subDir&gt;/&lt;subDir&gt;/&lt;SnippetID&gt;.</dd>
</dl>
</li>
</ul>
<a name="getFile-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getFile</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;getFile(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
                    <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
                    <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData)</pre>
<div class="block">Returns a <code>File</code> object to an existing file.  Analogous to <code>new File(filename)</code>.
 Now also fetches the file from Salesforce and S3 if possible</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>requestedID</code> - the 18 or 37 character .../allfiles/... ID, the SF prefix is ignored</dd>
<dd><code>filename</code> - the file name</dd>
<dd><code>kbData</code> - the kbData required to check for S3 operation, if NULL then S3 is not consulted</dd>
</dl>
</li>
</ul>
<a name="getFile-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-java.util.Date-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getFile</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;getFile(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
                    <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
                    <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
                    <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Date.html?is-external=true" title="class or interface in java.util">Date</a>&nbsp;lastModified)</pre>
<div class="block">Returns a <code>File</code> object to an existing file.  Analogous to <code> new File(filename)</code>.
 Now also fetches the file from S3 if enabled and the lastModified < file.lastModified
 Now also fetches the file from Salesforce if enabled and the lastModified < file.lastModified #47489 CMA180411

 NOTES FROM ERIC TO ME: If the requestedID is a composite ID then attempt SF download else check S3 download.
 Always use kbData.URL, change page_PDF to alert or make noise if it needs to download??</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>requestedID</code> - the 18 or 37 character .../allfiles/... ID</dd>
<dd><code>filename</code> - the base file name</dd>
<dd><code>kbData</code> - the kbData required to check for S3/salesforce operation, if NULL then S3/salesforce is not consulted</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>3.2.21 #39766 load balanced synchronization problem, 3.5.4.-case48027 CMA180430 #48027 Refactored getFile to correct RuntimeException due to mis-interpreted dbID(requestedID) lookup</dd>
</dl>
</li>
</ul>
<a name="getCanonicalPath-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCanonicalPath</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;getCanonicalPath(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
                               <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
                               <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData)
                        throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Returns a canonical file path String to an existing file.  Throws an exception if the file does not exist.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>requestedID</code> - the 18 or 37 character .../allfiles/... ID, the SF prefix is ignored</dd>
<dd><code>filename</code> - the file name</dd>
<dd><code>kbData</code> - a valid KBData object</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a file path String</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - from the File.getCanonicalPath();</dd>
</dl>
</li>
</ul>
<a name="getAbsolutePath-java.lang.String-java.lang.String-com.knowledgebin.kb.KBData-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getAbsolutePath</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;getAbsolutePath(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;requestedID,
                              <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;filename,
                              <a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData)</pre>
<div class="block">Returns an absolute file path String to a file in the .../allfiles/... filesystem.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>requestedID</code> - the 18 or 37 character .../allfiles/... ID, the SF prefix is ignored</dd>
<dd><code>filename</code> - the file name</dd>
<dd><code>kbData</code> - a valid KBData object</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a file path String</dd>
</dl>
</li>
</ul>
<a name="getDir-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getDir</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;getDir(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;allfilesPathID)</pre>
<div class="block">Returns a <code>File</code> object to a directory.  Analogous to <code> new File(dirName); </code>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>allfilesPathID</code> - the 18 .../allfiles/... ID</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a <code>File</code> object containing the directory</dd>
</dl>
</li>
</ul>
<a name="mkdir-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mkdir</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;mkdir(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;allfilesPathID)
           throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Creates a new directory if one does not already exist.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>allfilesPathID</code> - the 18 character .../allfiles/... ID</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a <code>File</code> object</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code> - if unable to create the directories</dd>
</dl>
</li>
</ul>
<a name="persistToSalesforce-com.knowledgebin.kb.KBData-javax.servlet.http.HttpServletRequest-java.lang.String-java.io.File-org.apache.log4j.Logger-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>persistToSalesforce</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;persistToSalesforce(<a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
                                  javax.servlet.http.HttpServletRequest&nbsp;request,
                                  <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;destAllfilesPathID,
                                  <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;destFile,
                                  org.apache.log4j.Logger&nbsp;logger)</pre>
<div class="block">NOTE: CRN170418 I CAN'T STRESS THIS ENOUGH: This method should be called by default by the persist() method.
 This code shouldn't be scattered hither and yon; it should be in a central location. And it should be handled
 automatically when persist is called since it should be part of the job performed by persist.

 NOTE 2: The code this is copied from (agentUpload.jsp) runs the file through PDFappend in order to password-protect
 the file but the code I'm going to be calling this from right now has already password-protected the file. When
 this functionality is in persist() as it belongs, we'll need to address when the file should and shouldn't be
 password-protected. Maybe persist should be called with the path to the temp location of the file and it should
 generate its allfiles location and place it there and password-protect it as needed?

 NOTE 3: Ken makes some very good suggestions about how the document should be stored in Salesforce. I'm immortalizing
 his suggestions here:

 Hope you don't mind if I kibitz on the topic of zStore and this case.  Another idea, assuming it can be done during
 the same API call, would be to have a SF checkbox field on the zStore record updated with a true value every time
 you add a new attachment.  Then have a SF workflow update a "counter" field appropriately and set the value back
 to false.  In that way you would have a counter and you could do an audit against it.

 I also have a long term suggestion that you create a new zStore record once a month (or even daily).  This has
 several benefits:
   1) This way you can easily report on it
   2) One day when we offer some sort of retention policy it would be easy to delete the correct date range of
      documents by deleting the correct SF records (obviously only works for clients that store docs in
      Salesforce - which happens to be ALL of the Enterprise type clients.)  
   3) Furthermore, if there ever is a problem it will be much easier to see "when" it happened.  
   4) Finally, by breaking this up into different records by period, we would likely avoid what we all suspect is
      inevitable - that there is a limit to the number of attachments on a single SF record.

 Convenience method to persist the AllFiles type file to Salesforce.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>kbData</code> - the current KBData object containing valid S3 and retention configuration</dd>
<dd><code>destFile</code> - the file that should be uploaded to Salesforce</dd>
<dd><code>logger</code> - the log4j Logger of the current caller</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>For now, we'll return the new URL (contains the SF Attachment ID in it) so that it can be persisted to the Snippet (not calling saveToDB here)</dd>
</dl>
</li>
</ul>
<a name="persist-com.knowledgebin.kb.KBData-java.io.File-org.apache.log4j.Logger-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>persist</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;persist(<a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
                      <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;srcFile,
                      org.apache.log4j.Logger&nbsp;logger)
               throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Convenience function to persist the AllFiles type file to the most appropriate repository</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>kbData</code> - the current KBData object containing valid S3 and retention configuration</dd>
<dd><code>srcFile</code> - the file within the ${zPaperBasePath}/allfiles directory</dd>
<dd><code>logger</code> - the log4j Logger of the current caller</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd>
</dl>
</li>
</ul>
<a name="persist-com.knowledgebin.kb.KBData-java.io.File-int-org.apache.log4j.Logger-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>persist</h4>
<pre>public&nbsp;<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;persist(<a href="../../../com/knowledgebin/kb/KBData.html" title="class in com.knowledgebin.kb">KBData</a>&nbsp;kbData,
                      <a href="https://docs.oracle.com/javase/8/docs/api/java/io/File.html?is-external=true" title="class or interface in java.io">File</a>&nbsp;srcFile,
                      int&nbsp;retention,
                      org.apache.log4j.Logger&nbsp;logger)
               throws <a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></pre>
<div class="block">Persist the .../allfiles/... file to the most appropriate repository</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>kbData</code> - the current KBData object containing valid S3/Salesforce.com and retention configuration</dd>
<dd><code>srcFile</code> - the file within the ${zPaperBasePath}/allfiles directory</dd>
<dd><code>retention</code> - the positive number of minutes to wait before removing the file from cache - 0 means forever</dd>
<dd><code>logger</code> - the log4j Logger of the current caller</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/8/docs/api/java/io/IOException.html?is-external=true" title="class or interface in java.io">IOException</a></code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/AllFiles.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../com/knowledgebin/kb/BarcodeEmitter.html" title="class in com.knowledgebin.kb"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/knowledgebin/kb/AllFiles.html" target="_top">Frames</a></li>
<li><a href="AllFiles.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2021 zPaper. All rights reserved.</small></p>
</body>
</html>
